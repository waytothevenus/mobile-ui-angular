{
    "title": "Analog clock time picker with $drag",
    "tabs": [
        {
            "type": "html",
            "code": "<span class=\"hljs-tag\">&lt;<span class=\"hljs-title\">div</span> <span class=\"hljs-attribute\">class</span>=<span class=\"hljs-value\">\"clock-header\"</span>&gt;</span>\n  <span class=\"hljs-tag\">&lt;<span class=\"hljs-title\">div</span> <span class=\"hljs-attribute\">class</span>=<span class=\"hljs-value\">\"selected-hour\"</span>&gt;</span>\n    {{ selectedHour || \"--\" }} : 00\n  <span class=\"hljs-tag\">&lt;/<span class=\"hljs-title\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;/<span class=\"hljs-title\">div</span>&gt;</span>\n<span class=\"hljs-tag\">&lt;<span class=\"hljs-title\">clock</span> <span class=\"hljs-attribute\">ng-model</span>=<span class=\"hljs-value\">\"selectedHour\"</span>&gt;</span><span class=\"hljs-tag\">&lt;/<span class=\"hljs-title\">clock</span>&gt;</span>"
        },
        {
            "type": "js",
            "code": "app.run([<span class=\"hljs-string\">'$rootScope'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">($rootScope)</span></span>{\n  $rootScope.selectedHour = <span class=\"hljs-number\">12</span>;\n}]);\n\napp.directive(<span class=\"hljs-string\">'clock'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">($drag, $transform)</span> </span>{\n  <span class=\"hljs-keyword\">return</span> {\n    restrict: <span class=\"hljs-string\">'E'</span>,\n    scope: {\n      model: <span class=\"hljs-string\">\"=ngModel\"</span>  \n    },\n    compile: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(clockElem)</span> </span>{\n      <span class=\"hljs-keyword\">var</span> $hour, $hand, $hours = [];\n      \n      <span class=\"hljs-keyword\">for</span> (<span class=\"hljs-keyword\">var</span> h = <span class=\"hljs-number\">1</span>; h &lt;= <span class=\"hljs-number\">12</span>; h++) {\n        $hour = angular.element(<span class=\"hljs-string\">'&lt;div class=\"clock-hour\"&gt;'</span> + h + <span class=\"hljs-string\">'&lt;/div&gt;'</span>);\n        clockElem.append($hour);\n        $transform.set($hour,\n          <span class=\"hljs-string\">'rotate('</span> + (<span class=\"hljs-number\">30</span> * h - <span class=\"hljs-number\">90</span>) + <span class=\"hljs-string\">'deg) translateX(100px) rotate('</span> + (-<span class=\"hljs-number\">30</span> * h + <span class=\"hljs-number\">90</span>) + <span class=\"hljs-string\">'deg)'</span>);\n        $hours.push($hour);\n      }\n      $hand = angular.element(<span class=\"hljs-string\">'&lt;div class=\"clock-hand\"&gt;&lt;/div&gt;'</span>);\n      clockElem.append($hand);\n\n      <span class=\"hljs-keyword\">var</span> centerHandToHour = <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(hour)</span> </span>{\n        $transform.set($hand, \n          <span class=\"hljs-string\">'rotate('</span> + (<span class=\"hljs-number\">30</span> * hour - <span class=\"hljs-number\">90</span>) + <span class=\"hljs-string\">'deg) translateX(100px)'</span>);\n      };\n\n      <span class=\"hljs-keyword\">return</span> <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span> <span class=\"hljs-title\">postLink</span><span class=\"hljs-params\">(scope, element)</span> </span>{\n        <span class=\"hljs-keyword\">var</span> dragging = <span class=\"hljs-literal\">false</span>;\n\n        <span class=\"hljs-keyword\">var</span> unwatch = scope.$watch(<span class=\"hljs-string\">'model'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(h)</span> </span>{\n          <span class=\"hljs-keyword\">if</span> (!dragging) { centerHandToHour(h); }\n        });\n\n        element.on(<span class=\"hljs-string\">'$destroy'</span>, <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n          unwatch();\n        });\n\n        $drag.bind($hand, {\n          transform: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(element, transform, touch)</span> </span>{\n            <span class=\"hljs-keyword\">var</span> r = clockElem[<span class=\"hljs-number\">0</span>].getBoundingClientRect(),\n                c = rectCenter(r),\n                at = <span class=\"hljs-built_in\">Math</span>.atan2(touch.y - c.y, \n                                touch.x - c.x) || <span class=\"hljs-number\">0</span>\n                a  = rad2deg(at);\n            <span class=\"hljs-keyword\">return</span> <span class=\"hljs-string\">'rotate('</span> + a + <span class=\"hljs-string\">'deg) translateX(100px)'</span>;\n          },\n          start: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n            dragging = <span class=\"hljs-literal\">true</span>;\n          },\n          move: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(drag)</span> </span>{\n            <span class=\"hljs-comment\">// gets all the distances between the hand and hours</span>\n            <span class=\"hljs-comment\">// and sets model to the nearest hour</span>\n            <span class=\"hljs-keyword\">var</span> i, dist, \n                dists = [],\n                rhand = $hand[<span class=\"hljs-number\">0</span>].getBoundingClientRect();\n\n            <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; $hours.length; i++) {\n              dists.push(distanceBetweenRects(rhand, $hours[i][<span class=\"hljs-number\">0</span>].getBoundingClientRect()));\n            }\n\n            <span class=\"hljs-keyword\">var</span> mindist = <span class=\"hljs-literal\">Infinity</span>;\n            <span class=\"hljs-keyword\">var</span> nearest;\n\n            <span class=\"hljs-keyword\">for</span> (i = <span class=\"hljs-number\">0</span>; i &lt; dists.length; i++) {\n              <span class=\"hljs-keyword\">if</span> (dists[i] &lt; mindist) {\n                mindist = dists[i];\n                nearest = i + <span class=\"hljs-number\">1</span>;\n              }\n            }\n\n            <span class=\"hljs-keyword\">if</span> (nearest !== scope.model) {\n              scope.$apply(<span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">()</span> </span>{\n                scope.model = nearest;\n              });\n            }\n          },\n          end: <span class=\"hljs-function\"><span class=\"hljs-keyword\">function</span><span class=\"hljs-params\">(drag)</span> </span>{\n            centerHandToHour(scope.model);\n            dragging = <span class=\"hljs-literal\">false</span>;\n          }\n        });        \n      }\n    }\n  };\n});"
        },
        {
            "type": "css",
            "code": "<span class=\"hljs-class\">.clock-header</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">background</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#444</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">color</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#fff</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">font-size</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">23px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">line-height</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">40px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">text-align</span>:<span class=\"hljs-value\"> center</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-moz-box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-webkit-box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n<span class=\"hljs-rule\">}</span></span>\n\n<span class=\"hljs-class\">.clock-hour</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-moz-box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-webkit-box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">box-shadow</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">0</span> <span class=\"hljs-number\">1px</span> <span class=\"hljs-number\">2px</span> <span class=\"hljs-function\">rgba</span>(<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0</span>,<span class=\"hljs-number\">0.5</span>)</span></span>;\n<span class=\"hljs-rule\">}</span></span>\n\n<span class=\"hljs-class\">.clock-hour</span>, <span class=\"hljs-class\">.clock-hand</span>, <span class=\"hljs-class\">.clock-hour</span><span class=\"hljs-pseudo\">:hover</span>, <span class=\"hljs-class\">.clock-hour</span><span class=\"hljs-pseudo\">:active</span>, <span class=\"hljs-class\">.clock-hour</span><span class=\"hljs-pseudo\">:focus</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">border-radius</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">999px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">background</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#444</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">color</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#f4f4f4</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">width</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">30px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">height</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">30px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">display</span>:<span class=\"hljs-value\"> block</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">position</span>:<span class=\"hljs-value\"> absolute</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">top</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">50%</span></span></span>; <span class=\"hljs-rule\"><span class=\"hljs-attribute\">left</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">50%</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">margin-top</span>:<span class=\"hljs-value\"> -<span class=\"hljs-number\">15px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">margin-left</span>:<span class=\"hljs-value\"> -<span class=\"hljs-number\">15px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">text-align</span>:<span class=\"hljs-value\"> center</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">line-height</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">30px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">text-decoration</span>:<span class=\"hljs-value\"> none</span></span>;\n<span class=\"hljs-rule\">}</span></span>\n<span class=\"hljs-class\">.clock-hand</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">margin-top</span>:<span class=\"hljs-value\"> -<span class=\"hljs-number\">20px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">margin-left</span>:<span class=\"hljs-value\"> -<span class=\"hljs-number\">20px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">width</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">40px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">height</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">40px</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">background</span>:<span class=\"hljs-value\"> transparent</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">border</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">2px</span> solid <span class=\"hljs-hexcolor\">#444</span></span></span>;\n<span class=\"hljs-rule\">}</span></span>\n<span class=\"hljs-class\">.clock-hour</span><span class=\"hljs-pseudo\">:hover</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">text-decoration</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">color</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#fff</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">background</span>:<span class=\"hljs-value\"> <span class=\"hljs-hexcolor\">#333</span></span></span>;\n<span class=\"hljs-rule\">}</span></span>\n<span class=\"hljs-class\">.clock-hour</span><span class=\"hljs-pseudo\">:active</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">opacity</span>:<span class=\"hljs-value\"> .<span class=\"hljs-number\">7</span></span></span>;\n<span class=\"hljs-rule\">}</span></span>\n<span class=\"hljs-tag\">clock</span> <span class=\"hljs-rules\">{\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">display</span>:<span class=\"hljs-value\"> block</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">height</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">100%</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">width</span>:<span class=\"hljs-value\"> <span class=\"hljs-number\">100%</span></span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-webkit-touch-callout</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-webkit-user-select</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-khtml-user-select</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-moz-user-select</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">-ms-user-select</span>:<span class=\"hljs-value\"> none</span></span>;\n  <span class=\"hljs-rule\"><span class=\"hljs-attribute\">user-select</span>:<span class=\"hljs-value\"> none</span></span>;\n<span class=\"hljs-rule\">}</span></span>"
        }
    ]
}